(()=>{"use strict";var e=[{name:"Архыз",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/arkhyz.jpg"},{name:"Челябинская область",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/chelyabinsk-oblast.jpg"},{name:"Иваново",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/ivanovo.jpg"},{name:"Камчатка",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kamchatka.jpg"},{name:"Холмогорский район",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kholmogorsky-rayon.jpg"},{name:"Байкал",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/baikal.jpg"}];function t(e,t,n){var r=("https://nomoreparties.co/v1/wff-cohort-28/"+e).replaceAll(" ","");return fetch(r,{method:t,headers:{authorization:"321598a9-d89b-4d5f-b00c-2b7762da8c14","Content-Type":"application/json"},body:JSON.stringify(n)}).then((function(e){if(!e.ok)throw new Error("Ошибка запроса");return e.json()})).then((function(e){return e})).catch((function(e){return e}))}var n="card__like-button_is-active",r=document.querySelector("#card-template").content;function o(e,t,o,a,i,c,u){var l=r.querySelector(".card").cloneNode(!0),s=l.querySelector(".card__image"),d=l.querySelector(".card__title"),p=l.querySelector(".card__delete-button"),f=l.querySelector(".card__like-button"),m=l.querySelector(".card__like-count");return d.textContent=e.name,s.src=e.link,s.alt=e.name,void 0===e.likes.length?m.textContent=0:m.textContent=e.likes.length,i==e.owner._id?p.addEventListener("click",(function(){return t(l,c,e)})):p.classList.add("card__delete-button-hide"),e.likes.some((function(e){return e._id===i}))&&f.classList.add(n),f.addEventListener("click",(function(){u(e,f,m,o)})),s.addEventListener("click",(function(){return a(e)})),l}function a(e,t,n){t(n._id,e)}var i="popup_is-opened";function c(e){e.classList.add(i),document.addEventListener("keydown",s)}function u(e){e.classList.remove(i),document.removeEventListener("keydown",s)}function l(e){e.addEventListener("click",(function(t){t.target.classList.contains(i)&&u(e)}))}function s(e){"Escape"===e.key&&u(document.querySelector("."+i))}var d=function(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(n.inputErrorClass),o.classList.add(n.errorClass),o.textContent=r},p=function(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""},f=function(e,t){e.classList.add("popup__button_disabled"),e.disabled=!0},m=function(e,t){e.classList.remove("popup__button_disabled"),e.disabled=!1};function v(e,t){e.querySelectorAll(t.inputSelector).forEach((function(n){p(e,n,t)}));var n=e.querySelector(t.submitButtonSelector);m(n,t)}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var _={cardList:".places__list",showElement:"popup_is-opened",buttonClose:".popup__close",windowAnimated:"popup_is-animated",userProfileEditButton:".profile__edit-button",windowEditProfile:".popup_type_edit",formEditProfile:"edit-profile",onPageUserName:".profile__title",onPageUserDescription:".profile__description",windowImage:".popup_type_image",formImageTitle:".popup__caption",formImageLink:".popup__image",createNewCardButton:".profile__add-button",windowNewCard:".popup_type_new-card",counterLike:".card__like-count",onPageUserAvatar:".profile__image",windowDelete:".popup_type_confirmation_delete",confirmationDeleteButton:".popup__confirmation-button",windowAvatar:".popup_type_avatar-card",formAvatarProfile:"new-avatar",errorUpdateUserData:"Произошла ошибка при сохранении данных пользователя",errorUpdateUserAvatar:"Произошла ошибка при обновлении аватарки пользователя",errorNoUserAvatar:"./images/avatar.jpg",errorGetCards:"Данные с карточками не получены",messageButtonLoading:"Сохранение...",messageButtonDefault:"Сохранить"},g={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},S=document.querySelector(_.cardList),h=document.querySelector(_.userProfileEditButton),b=document.querySelector(_.onPageUserAvatar),k="",E="users/me/",C="cards/",L="cards/likes/",w=document.querySelector(_.windowImage),q=w.querySelector(_.buttonClose),x=w.querySelector(_.formImageTitle),A=w.querySelector(_.formImageLink);function P(e){x.textContent=e.name,A.src=e.link,A.alt=e.name,c(w)}ae(w),l(w),q.addEventListener("click",(function(){u(w)}));var U=document.querySelector(_.windowEditProfile),B=document.forms[_.formEditProfile],D=U.querySelector(_.buttonClose),j=B.name,T=B.description,I=document.querySelector(_.onPageUserName),N=document.querySelector(_.onPageUserDescription),O=document.querySelector(_.onPageUserAvatar),G=U.querySelector(g.submitButtonSelector);ae(U),l(U),b.addEventListener("click",(function(){Z.classList.add(_.showElement)})),re(B,U,(function(){var e={name:j.value,about:T.value};G.textContent=_.messageButtonLoading,t(E,"PATCH",e).then((function(t){I.textContent=e.name,N.textContent=e.about})).catch((function(e){return alert(_.errorUpdateUserData+e)})).finally((function(){u(U),G.textContent=_.messageButtonDefault}))})),D.addEventListener("click",(function(){v(B,g),u(U)})),h.addEventListener("click",(function(){j.value=I.textContent,T.value=N.textContent,c(U)}));var M=document.querySelector(_.windowNewCard),z=M.querySelector(_.buttonClose),H=document.querySelector(_.createNewCardButton),V=document.forms["new-place"],J=V["place-name"],$=V.link,F=M.querySelector(g.submitButtonSelector);ae(M),l(M),re(V,M,(function(){var e={name:J.value,link:$.value};F.textContent=_.messageButtonLoading;var n=t(C,"POST",e);n.then((function(e){S.prepend(o(e,a,L,P,k,K,Q)),n.catch((function(e){return alert(_.errorUpdateUserAvatar+e)})),n.finally((function(){u(M),F.textContent=_.messageButtonDefault}))}))})),z.addEventListener("click",(function(){v(B,g),u(M)})),H.addEventListener("click",(function(){oe(V),c(M)}));var K=function(e,n){R.classList.add(_.showElement),W.addEventListener("click",(function(){t(C+e,"DELETE"),n.remove(),u(R)}))};function Q(e,r,o,a){r.classList.contains(n)?function(e,r,o,a){t(a+e._id,"DELETE").then((function(e){r.classList.remove(n),o.textContent=e.likes.length}))}(e,r,o,a):function(e,r,o,a){t(a+e._id,"PUT").then((function(e){r.classList.add(n),o.textContent=e.likes.length}))}(e,r,o,a)}var R=document.querySelector(_.windowDelete),W=R.querySelector(_.confirmationDeleteButton),X=R.querySelector(_.buttonClose);ae(R),l(R),X.addEventListener("click",(function(){v(B,g),u(R)}));var Y,Z=document.querySelector(_.windowAvatar),ee=Z.querySelector(_.buttonClose),te=document.forms[_.formAvatarProfile],ne=te["avatar-link"];function re(e,t,n){e.addEventListener("submit",(function(e){e.preventDefault(),n(),u(t)}))}function oe(e){e.reset()}function ae(e){e.classList.add(_.windowAnimated)}ae(Z),l(Z),ee.addEventListener("click",(function(){v(te,g),u(Z)})),re(te,Z,(function(){var e={avatar:ne.value},n=t(E+"avatar/","PATCH",e);F.textContent=_.messageButtonLoading,n.then((function(e){b.style.backgroundImage="url('"+e.avatar+"')",oe(te)})).catch((function(e){return alert(_.errorUpdateUserAvatar+e)})).finally((function(){F.textContent=_.messageButtonDefault}))})),Y=g,document.querySelectorAll(Y.formSelector).forEach((function(e){e.querySelectorAll(Y.inputSelector).forEach((function(t){t.addEventListener("input",(function(){!function(e,t,n){var r=e.querySelector(n.submitButtonSelector);t.validity.patternMismatch?t.setCustomValidity(t.dataset.regexpError):t.setCustomValidity(""),t.validity.valid?(p(e,t,n),m(r,n)):(d(e,t,n,t.validationMessage),f(r,n))}(e,t,Y)}))}))})),Promise.all([t(E,"GET"),t(C,"GET")]).then((function(e){var t,n,r=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,i,c=[],u=!0,l=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(c.push(r.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(t,n)||function(e,t){if(e){if("string"==typeof e)return y(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?y(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=r[0],c=r[1];I.textContent=i.name,N.textContent=i.about,O.src=i.avatar,k=i._id,b.style.backgroundImage="url('"+i.avatar+"')",c.forEach((function(e){S.append(o(e,a,L,P,k,K,Q))}))})).catch((function(t){alarm(_.errorGetCards+t),_.onPageUserName="Не найден",_.onPageUserDescription="Не найден",e.forEach((function(e){S.append(o(e,a,P))}))}))})();