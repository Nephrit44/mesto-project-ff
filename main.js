(()=>{"use strict";var e={templateCard:"#card-template",basicCard:".card",placeForImage:".card__image",basicCardName:".card__title",basicCardDeleteButton:".card__delete-button",basicCardDeleteButtonHide:"card__delete-button-hide",basicCardLikeButton:".card__like-button",basicCardLikeCouner:".card__like-count",basicCardLikeUnlike:"card__like-button_is-active",errorLike:"Во время установки Like, произошла ошибка",errorDislike:"Во время удаления Like, произошла ошибка",errorCreateCard:"Произошла ошибка при создании карточки"},t=document.querySelector(e.templateCard).content;function n(n,r,o,a,i){var c=t.querySelector(e.basicCard).cloneNode(!0),u=c.querySelector(e.placeForImage),l=c.querySelector(e.basicCardName),s=c.querySelector(e.basicCardDeleteButton),d=c.querySelector(e.basicCardLikeButton),f=c.querySelector(e.basicCardLikeCouner);return l.textContent=n.name,u.src=n.link,u.alt=n.name,void 0===n.likes.length?f.textContent=0:f.textContent=n.likes.length,a!=n.owner._id&&s.classList.add(e.basicCardDeleteButtonHide),s.addEventListener("click",(function(){i(n,c)})),n.likes.some((function(e){return e._id===a}))&&d.classList.add(e.basicCardLikeUnlike),d.addEventListener("click",(function(){o(n,d,f,e)})),u.addEventListener("click",(function(){return r(n)})),c}var r="popup_is-opened";function o(e){e.classList.add(r),document.addEventListener("keydown",c)}function a(e){e.classList.remove(r),document.removeEventListener("keydown",c)}function i(e){e.addEventListener("click",(function(t){t.target.classList.contains(r)&&a(e)}))}function c(e){"Escape"===e.key&&a(document.querySelector("."+r))}var u=function(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(n.inputErrorClass),o.classList.add(n.errorClass),o.textContent=r},l=function(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""},s=function(e,t){e.classList.add(t.inactiveButtonClass),e.disabled=!0},d=function(e,t){e.classList.remove(t.inactiveButtonClass),e.disabled=!1};function f(e,t){e.querySelectorAll(t.inputSelector).forEach((function(n){l(e,n,t)}));var n=e.querySelector(t.submitButtonSelector);d(n,t)}function p(e,t,n){var r=("https://nomoreparties.co/v1/wff-cohort-28/"+e).replaceAll(" ","");return fetch(r,{method:t,headers:{authorization:"321598a9-d89b-4d5f-b00c-2b7762da8c14","Content-Type":"application/json"},body:JSON.stringify(n)}).then((function(e){return function(e){if(!e.ok)throw new Error("Ошибка запроса ".concat(response.status));return e.json()}(e)}))}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var v={cardDataID:"",cardElement:""},y={cardList:".places__list",showElement:"popup_is-opened",buttonClose:".popup__close",windowAnimated:"popup_is-animated",userProfileEditButton:".profile__edit-button",windowEditProfile:".popup_type_edit",formEditProfile:"edit-profile",onPageUserName:".profile__title",onPageUserDescription:".profile__description",windowImage:".popup_type_image",formImageTitle:".popup__caption",formImageLink:".popup__image",createNewCardButton:".profile__add-button",windowNewCard:".popup_type_new-card",counterLike:".card__like-count",onPageUserAvatar:".profile__image",windowDelete:".popup_type_confirmation_delete",confirmationDeleteButton:".popup__confirmation-button",windowAvatar:".popup_type_avatar-card",formAvatarProfile:"new-avatar",errorUpdateUserData:"Произошла ошибка при сохранении данных пользователя. ",errorUpdateUserAvatar:"Произошла ошибка при обновлении аватарки пользователя. ",errorNoUserAvatar:"./images/avatar.jpg",errorGetCards:"Данные с карточками не получены. ",errorDeleteCard:"При попытке удалить карточку, произошла ошибка. ",errorLikeCard:"Произошла ошибка при попытке Лайкнуть карту. ",errorDislikeCard:"Произошла ошибка при попытке снять Лайк с карты. ",messageButtonLoading:"Сохранение...",messageButtonDefault:"Сохранить"},C={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},_=document.querySelector(y.cardList),b=document.querySelector(y.userProfileEditButton),g=document.querySelector(y.onPageUserAvatar),k="",L="users/me/",S="cards/",E="cards/likes/",h=document.querySelector(y.windowImage),w=h.querySelector(y.buttonClose),q=h.querySelector(y.formImageTitle),D=h.querySelector(y.formImageLink);function B(e){q.textContent=e.name,D.src=e.link,D.alt=e.name,o(h)}oe(h),i(h),w.addEventListener("click",(function(){a(h)}));var U=document.querySelector(y.windowEditProfile),A=document.forms[y.formEditProfile],x=U.querySelector(y.buttonClose),P=A.name,I=A.description,N=document.querySelector(y.onPageUserName),T=document.querySelector(y.onPageUserDescription),j=document.querySelector(y.onPageUserAvatar),O=U.querySelector(C.submitButtonSelector);oe(U),i(U),ne(A,(function(){var e={name:P.value,about:I.value};O.textContent=y.messageButtonLoading,p(L,"PATCH",e).then((function(t){N.textContent=e.name,T.textContent=e.about,a(U)})).catch((function(e){return console.log(y.errorUpdateUserData+rejected)})).finally((function(){O.textContent=y.messageButtonDefault}))})),x.addEventListener("click",(function(){f(A,C),a(U)})),b.addEventListener("click",(function(){P.value=N.textContent,I.value=T.textContent,o(U)}));var G=document.querySelector(y.windowNewCard),H=G.querySelector(y.buttonClose),M=document.querySelector(y.createNewCardButton),F=document.forms["new-place"],V=F["place-name"],z=F.link,J=G.querySelector(C.submitButtonSelector);function $(e,t,n,r){t.classList.contains(r.basicCardLikeUnlike)?function(e,t,n,r){p(E+e._id,"DELETE").then((function(e){t.classList.remove(r.basicCardLikeUnlike),n.textContent=e.likes.length})).catch((function(e){console.log(y.errorDislikeCard+e)})).finally((function(){}))}(e,t,n,r):function(e,t,n,r){p(E+e._id,"PUT").then((function(e){t.classList.add(r.basicCardLikeUnlike),n.textContent=e.likes.length})).catch((function(e){console.log(y.errorLikeCard+e)})).finally((function(){}))}(e,t,n,r)}oe(G),i(G),ne(F,(function(){var e={name:V.value,link:z.value};J.textContent=y.messageButtonLoading,p(S,"POST",e).then((function(e){_.prepend(n(e,B,$,k,W)),a(G)})).catch((function(e){return console.log(y.errorUpdateUserAvatar+e)})).finally((function(){J.textContent=y.messageButtonDefault}))})),H.addEventListener("click",(function(){a(G)})),M.addEventListener("click",(function(){f(F,C),re(F),o(G)}));var K=document.querySelector(y.windowDelete),Q=K.querySelector(y.confirmationDeleteButton),R=K.querySelector(y.buttonClose);function W(e,t){v.cardDataID=e._id,v.cardElement=t,o(K)}oe(K),i(K),R.addEventListener("click",(function(){a(K)})),Q.addEventListener("click",(function(){!function(e,t,n){p(e+t,"DELETE").then((function(e){n.remove(),a(K)})).catch((function(e){console.log(y.errorDeleteCard+e)}))}(S,v.cardDataID,v.cardElement)}));var X,Y=document.querySelector(y.windowAvatar),Z=Y.querySelector(y.buttonClose),ee=document.forms[y.formAvatarProfile],te=ee["avatar-link"];function ne(e,t){e.addEventListener("submit",(function(e){e.preventDefault(),t()}))}function re(e){e.reset()}function oe(e){e.classList.add(y.windowAnimated)}oe(Y),i(Y),g.addEventListener("click",(function(){re(ee),o(Y)})),Z.addEventListener("click",(function(){f(ee,C),a(Y)})),ne(ee,(function(){var e={avatar:te.value};p(L+"avatar/","PATCH",e).then((function(e){J.textContent=y.messageButtonLoading,g.style.backgroundImage="url('"+e.avatar+"')",a(Y)})).catch((function(e){console.log(y.errorUpdateUserAvatar+e)})).finally((function(){J.textContent=y.messageButtonDefault}))})),X=C,document.querySelectorAll(X.formSelector).forEach((function(e){e.querySelectorAll(X.inputSelector).forEach((function(t){t.addEventListener("input",(function(){!function(e,t,n){var r=e.querySelector(n.submitButtonSelector);t.validity.patternMismatch?t.setCustomValidity(t.dataset.regexpError):t.setCustomValidity(""),t.validity.valid?(l(e,t,n),d(r,n)):(u(e,t,n,t.validationMessage),s(r,n))}(e,t,X)}))}))})),Promise.all([p(L,"GET"),p(S,"GET")]).then((function(e){var t,r,o=(r=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,i,c=[],u=!0,l=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(c.push(r.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(t,r)||function(e,t){if(e){if("string"==typeof e)return m(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(e,t):void 0}}(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),a=o[0],i=o[1];N.textContent=a.name,T.textContent=a.about,j.src=a.avatar,k=a._id,g.style.backgroundImage="url('"+a.avatar+"')",i.forEach((function(e){_.append(n(e,B,$,k,W))}))})).catch((function(e){console.log(y.errorGetCards+e),y.onPageUserName="Не найден",y.onPageUserDescription="Не найден"}))})();